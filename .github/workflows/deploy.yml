name: Deploy to InfinityFree via FTP

on:
  push:
    branches:
      - main

jobs:
  ftp-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: "ðŸ§© Checkout code"
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      # --- Náº¿u cáº§n build Tailwind CSS ---
      - name: "ðŸ“¦ Build Tailwind CSS (optional)"
        run: |
          cd frontend
          npm ci
          npx tailwindcss -i ./src/input.css -o ./dist/style.css --minify

      # --- Deploy frontend ---
      - name: "ðŸš€ Deploy frontend via lftp mirror"
        run: |
          cd frontend
          lftp -u ${{ secrets.FTP_USERNAME }},${{ secrets.FTP_PASSWORD }} ftp://${{ secrets.FTP_SERVER }} << EOF
            set ftp:ssl-allow no
            mirror -R -n ./ /htdocs/
            quit
EOF

      # --- Deploy PHP backend ---
      - name: "ðŸš€ Deploy backend via lftp mirror"
        run: |
          cd backend
          lftp -u ${{ secrets.FTP_USERNAME }},${{ secrets.FTP_PASSWORD }} ftp://${{ secrets.FTP_SERVER }} << EOF
            set ftp:ssl-allow no
            mirror -R -n ./ /htdocs/api/
            quit
EOF
